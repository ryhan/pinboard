// Generated by CoffeeScript 1.6.1
var Pinboard,PinboardGrid,_this=this;Pinboard=function(){function r(e){var t=this;this.lay_blocks=function(){return r.prototype.lay_blocks.apply(t,arguments)};this._place=function(e,n){return r.prototype._place.apply(t,arguments)};this.pins=e;this.html=$("<div class='pinboard' />");this.set_grid_size();$.map(this.pins,function(e){return t.html.append(e.html)})}var e,t,n;t=300;e=250;n=2;r.prototype.update=function(){var e,t=this;e=this.set_grid_size();e&&this.fit_blocks();this.lay_blocks();return $(window).resize(function(){return t.update()})};r.prototype.set_grid_size=function(){var n,r,i,s;r=this.x_count;i=this.y_count;s=this.html.width();n=this.html.height();this.x_count=Math.floor(s/t);this.y_count=Math.floor(n/e);this.x_unit=parseInt(s/this.x_count);this.y_unit=parseInt(n/this.y_count);return r!==this.x_count||i!==this.y_count};r.prototype.fit_blocks=function(){this.grid=new PinboardGrid(this.y_count,this.x_count);this._clear_pin_values();this.pins=_.shuffle(this.pins);this._fit_zoomed();return this._fit_remaining()};r.prototype._clear_pin_values=function(){var e,t,n,r,i;r=this.pins;i=[];for(t=0,n=r.length;t<n;t++){e=r[t];e.zoom=!1;e.row=-1;i.push(e.column=-1)}return i};r.prototype._fit_zoomed=function(){var e,t,r,i,s,o;this.size=2;s=this.pins.slice(0,n);o=[];for(r=0,i=s.length;r<i;r++){t=s[r];t.zoom=!0;e=this.grid.find(this.size);e.length<1?o.push(void 0):o.push(this._place(t,e[Math.floor(Math.random()*e.length)]))}return o};r.prototype._fit_remaining=function(){var e,t,n,r,i,s;this.size=1;e=this.grid.find(this.size);i=this.pins;s=[];for(n=0,r=i.length;n<r;n++){t=i[n];t.zoom||e.length<1?s.push(void 0):s.push(this._place(t,e.shift()))}return s};r.prototype._place=function(e,t){this.grid.place(t.row,t.column,this.size);e.row=t.row;return e.column=t.column};r.prototype.lay_blocks=function(){var e,t,n,r,i;r=this.pins;i=[];for(t=0,n=r.length;t<n;t++){e=r[t];this._set_zoom_css(e);i.push(this._set_position_css(e))}return i};r.prototype._set_zoom_css=function(e){var t,n;if(e.zoom){t=2*this.y_unit+"px";n=2*this.x_unit+"px"}else{t=this.y_unit+"px";n=this.x_unit+"px"}return e.html.css({height:t,width:n})};r.prototype._set_position_css=function(e){var t,n,r;n=1;if(e.row<0||e.column<0)n=0;r=e.row*this.y_unit+"px";t=e.column*this.x_unit+"px";return e.html.css({opacity:n,top:r,left:t})};return r}();PinboardGrid=function(){function e(t,n){var r=this;this._is_empty=function(t,n,i){return e.prototype._is_empty.apply(r,arguments)};this.find=function(t){return e.prototype.find.apply(r,arguments)};this.rows=t;this.columns=n;this.clear_matrix()}e.prototype.clear_matrix=function(){var e,t,n,r,i,s,o,u;this.matrix=[];u=[];for(t=r=1,s=this.rows;1<=s?r<=s:r>=s;t=1<=s?++r:--r){n=[];for(e=i=1,o=this.columns;1<=o?i<=o:i>=o;e=1<=o?++i:--i)n.push(0);u.push(this.matrix.push(n))}return u};e.prototype.place=function(e,t,n){var r,i,s,o,u;u=[];for(i=s=0,o=n-1;0<=o?s<=o:s>=o;i=0<=o?++s:--s)u.push(function(){var s,o,u;u=[];for(r=s=0,o=n-1;0<=o?s<=o:s>=o;r=0<=o?++s:--s)u.push(this.matrix[e+i][t+r]=1);return u}.call(this));return u};e.prototype.find=function(e){var t,n,r,i,s,o,u;if(e<0)return!1;n=[];for(r=i=0,o=this.rows-e;0<=o?i<=o:i>=o;r=0<=o?++i:--i)for(t=s=0,u=this.columns-e;0<=u?s<=u:s>=u;t=0<=u?++s:--s)this._is_empty(r,t,e)&&n.push({row:r,column:t});return n};e.prototype._is_empty=function(e,t,n){var r,i,s,o,u,a;for(i=s=0,u=n-1;0<=u?s<=u:s>=u;i=0<=u?++s:--s)for(r=o=0,a=n-1;0<=a?o<=a:o>=a;r=0<=a?++o:--o)if(this.matrix[e+i][t+r])return!1;return!0};return e}();