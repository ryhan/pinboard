// Generated by CoffeeScript 1.6.1
var Pinboard,_this=this;Pinboard=function(){function r(e){var t=this;this._find_empty_blocks=function(){return r.prototype._find_empty_blocks.apply(t,arguments)};this._is_empty=function(e,n){return r.prototype._is_empty.apply(t,arguments)};this._place=function(e,n){return r.prototype._place.apply(t,arguments)};this.lay_blocks=function(){return r.prototype.lay_blocks.apply(t,arguments)};this.pins=e;this.html=$("<div class='pinboard' />");this.set_grid_size();$.map(this.pins,function(e){return t.html.append(e.html)})}var e,t,n;t=300;e=250;n=2;r.prototype.update=function(){var e,t=this;e=this.set_grid_size();e&&this.fit_blocks();this.lay_blocks();return $(window).resize(function(){return t.update()})};r.prototype.set_grid_size=function(){var n,r,i,s;r=this.x_count;i=this.y_count;s=this.html.width();n=this.html.height();this.x_count=Math.floor(s/t);this.y_count=Math.floor(n/e);this.x_unit=parseInt(s/this.x_count);this.y_unit=parseInt(n/this.y_count);return r!==this.x_count||i!==this.y_count};r.prototype.fit_blocks=function(){this._create_empty_grid();this._clear_pin_values();this.pins=_.shuffle(this.pins);this._fit_zoomed();return this._fit_remaining()};r.prototype.lay_blocks=function(){var e,t,n,r,i;r=this.pins;i=[];for(t=0,n=r.length;t<n;t++){e=r[t];this._set_zoom_css(e);i.push(this._set_position_css(e))}return i};r.prototype._fit_zoomed=function(){var e,t,r,i,s,o;this.size=2;s=this.pins.slice(0,n);o=[];for(r=0,i=s.length;r<i;r++){t=s[r];t.zoom=!0;e=this._find_empty_blocks();e.length<1?o.push(void 0):o.push(this._place(t,e[Math.floor(Math.random()*e.length)]))}return o};r.prototype._fit_remaining=function(){var e,t,n,r,i,s;this.size=1;e=this._find_empty_blocks();i=this.pins;s=[];for(n=0,r=i.length;n<r;n++){t=i[n];t.zoom||e.length<1?s.push(void 0):s.push(this._place(t,e.shift()))}return s};r.prototype._place=function(e,t){this._fill_block(t.row,t.column);e.row=t.row;return e.column=t.column};r.prototype._set_zoom_css=function(e){var t,n;if(e.zoom){t=2*this.y_unit+"px";n=2*this.x_unit+"px"}else{t=this.y_unit+"px";n=this.x_unit+"px"}return e.html.css({height:t,width:n})};r.prototype._set_position_css=function(e){var t,n,r;n=1;if(e.row<0||e.column<0)n=0;r=e.row*this.y_unit+"px";t=e.column*this.x_unit+"px";return e.html.css({opacity:n,top:r,left:t})};r.prototype._create_empty_grid=function(){var e,t,n,r,i,s,o,u;this.grid=[];u=[];for(t=r=1,s=this.y_count;1<=s?r<=s:r>=s;t=1<=s?++r:--r){n=[];for(e=i=1,o=this.x_count;1<=o?i<=o:i>=o;e=1<=o?++i:--i)n.push(0);u.push(this.grid.push(n))}return u};r.prototype._clear_pin_values=function(){var e,t,n,r,i;r=this.pins;i=[];for(t=0,n=r.length;t<n;t++){e=r[t];e.zoom=!1;e.row=-1;i.push(e.column=-1)}return i};r.prototype._fill_block=function(e,t){var n,r,i,s,o;o=[];for(r=i=0,s=this.size-1;0<=s?i<=s:i>=s;r=0<=s?++i:--i)o.push(function(){var i,s,o;o=[];for(n=i=0,s=this.size-1;0<=s?i<=s:i>=s;n=0<=s?++i:--i)o.push(this.grid[e+r][t+n]=1);return o}.call(this));return o};r.prototype._is_empty=function(e,t){var n,r,i,s,o,u;for(r=i=0,o=this.size-1;0<=o?i<=o:i>=o;r=0<=o?++i:--i)for(n=s=0,u=this.size-1;0<=u?s<=u:s>=u;n=0<=u?++s:--s)if(this.grid[e+r][t+n])return!1;return!0};r.prototype._find_empty_blocks=function(){var e,t,n,r,i,s,o;if(this.size<0)return!1;t=[];for(n=r=0,s=this.y_count-this.size;0<=s?r<=s:r>=s;n=0<=s?++r:--r)for(e=i=0,o=this.x_count-this.size;0<=o?i<=o:i>=o;e=0<=o?++i:--i)this._is_empty(n,e)&&t.push({row:n,column:e});return t};return r}();