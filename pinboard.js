// Generated by CoffeeScript 1.6.1
var Pinboard;Pinboard=function(){function r(e){this.pins=e;this.html=$("<div class='pinboard' />")}var e,t,n;n=300;e=200;t=2;r.prototype.update=function(){var e=this;this._fill();return $.map(this.pins,function(t){return e.html.append(t.html)})};r.prototype._fill=function(){var e;e=this._determine_unit_size();this._adjust_pin_sizes(e);return this._allocate(e)};r.prototype._determine_unit_size=function(){var r,i,s,o,u,a,f;i=t;f=this.html.width();r=this.html.height();o=Math.floor(f/n);u=Math.floor(r/e);a=parseInt(f/o);s=parseInt(r/u);return{number_to_zoom:i,unit_width:a,unit_height:s,unit_horiz_count:o,unit_vert_count:u,width:f,height:r}};r.prototype._adjust_pin_sizes=function(e){var t=this;this.pins=_.shuffle(this.pins);$.map(this.pins,function(t,n){if(n<e.number_to_zoom){t.zoom=!0;return t.html.css({height:""+2*e.unit_height+"px",width:""+2*e.unit_width+"px"})}t.zoom=!1;return t.html.css({height:""+e.unit_height+"px",width:""+e.unit_width+"px"})});return this.pins=_.shuffle(this.pins)};r.prototype._allocate=function(e){var t,n,r,i,s,o,u,a,f,l,c,h;r=e.unit_horiz_count;l=e.unit_vert_count;o=[];for(a=c=1;1<=l?c<=l:c>=l;a=1<=l?++c:--c){f=[];for(n=h=1;1<=r?h<=r:h>=r;n=1<=r?++h:--h)f.push(0);o.push(f)}t=0;u=function(n){var u;if(t>=r*l)return!1;if(!n.zoom){u=s();if(u.y<0){n.html.css("display","none");return!1}o[u.y][u.x]=1;t+=1;n.html.css({top:""+u.y*e.unit_height+"px",left:""+u.x*e.unit_width+"px"});return!0}if(n.zoom){u=i();if(u.y<0||u.x<0){n.html.css({opacity:"0"});return!1}o[u.y][u.x]=1;o[u.y+1][u.x]=1;o[u.y][u.x+1]=1;o[u.y+1][u.x+1]=1;t+=4;n.html.css({top:""+u.y*e.unit_height+"px",left:""+u.x*e.unit_width+"px"});return!0}};s=function(){var e,t,i,s;for(a=e=0,i=l-1;0<=i?e<=i:e>=i;a=0<=i?++e:--e)for(n=t=0,s=r-1;0<=s?t<=s:t>=s;n=0<=s?++t:--t)if(!o[a][n])return{x:n,y:a};return{x:-1,y:-1}};i=function(){var e,t,i,s;for(a=e=0,i=l-2;0<=i?e<=i:e>=i;a=0<=i?++e:--e)for(n=t=0,s=r-2;0<=s?t<=s:t>=s;n=0<=s?++t:--t)if(!o[a][n]&&!o[a][n+1]&&!o[a+1][n+1]&&!o[a+1][n])return{x:n,y:a};return{x:-1,y:-1}};return $.map(this.pins,u)};return r}();