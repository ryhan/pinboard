// Generated by CoffeeScript 1.6.1
var Pinboard,_this=this;Pinboard=function(){function r(e){var t=this;this.lay_blocks=function(){return r.prototype.lay_blocks.apply(t,arguments)};this.pins=e;this.html=$("<div class='pinboard' />");this.set_grid_size();$.map(this.pins,function(e){return t.html.append(e.html)})}var e,t,n;t=300;e=250;n=2;r.prototype.update=function(){var e,t=this;e=this.set_grid_size();e&&this.fit_blocks();this.lay_blocks();return $(window).resize(function(){return t.update()})};r.prototype.set_grid_size=function(){var n,r,i,s;r=this.x_count;i=this.y_count;s=this.html.width();n=this.html.height();this.x_count=Math.floor(s/t);this.y_count=Math.floor(n/e);this.x_unit=parseInt(s/this.x_count);this.y_unit=parseInt(n/this.y_count);return r!==this.x_count||i!==this.y_count};r.prototype.fit_blocks=function(){var e,t,r,i,s,o,u,a,f,l,c,h,p,d=this;this._create_empty_grid();c=this.pins;for(o=0,f=c.length;o<f;o++){r=c[o];r.zoom=!1;r.row=-1;r.column=-1}i=function(e,t){d._fill_block(t.row,t.column,s);e.row=t.row;return e.column=t.column};s=2;this.pins=_.shuffle(this.pins);for(e=u=0;0<=n?u<=n:u>=n;e=0<=n?++u:--u){r=this.pins[e];r.zoom=!0;t=this._find_empty_blocks(s);t.length<1||i(r,t[Math.floor(Math.random()*t.length)])}s=1;t=this._find_empty_blocks(s);h=this.pins;p=[];for(a=0,l=h.length;a<l;a++){r=h[a];r.zoom||t.length<1?p.push(void 0):p.push(i(r,t.shift()))}return p};r.prototype.lay_blocks=function(){var e,t,n,r,i;r=this.pins;i=[];for(t=0,n=r.length;t<n;t++){e=r[t];this._set_zoom_css(e);i.push(this._set_position_css(e))}return i};r.prototype._set_zoom_css=function(e){var t,n;if(e.zoom){t=2*this.y_unit+"px";n=2*this.x_unit+"px"}else{t=this.y_unit+"px";n=this.x_unit+"px"}return e.html.css({height:t,width:n})};r.prototype._set_position_css=function(e){var t,n,r;n=1;if(e.row<0||e.column<0)n=0;r=e.row*this.y_unit+"px";t=e.column*this.x_unit+"px";return e.html.css({opacity:n,top:r,left:t})};r.prototype._create_empty_grid=function(){var e,t,n,r,i,s,o,u;this.grid=[];u=[];for(t=r=1,s=this.y_count;1<=s?r<=s:r>=s;t=1<=s?++r:--r){n=[];for(e=i=1,o=this.x_count;1<=o?i<=o:i>=o;e=1<=o?++i:--i)n.push(0);u.push(this.grid.push(n))}return u};r.prototype._fill_block=function(e,t,n){var r,i,s,o,u;u=[];for(i=s=0,o=n-1;0<=o?s<=o:s>=o;i=0<=o?++s:--s)u.push(function(){var s,o,u;u=[];for(r=s=0,o=n-1;0<=o?s<=o:s>=o;r=0<=o?++s:--s)u.push(this.grid[e+i][t+r]=1);return u}.call(this));return u};r.prototype._find_empty_blocks=function(e){var t,n,r,i,s,o,u,a,f=this;if(e<0)return!1;r=[];n=function(t,n){var r,i,s,o,u,a;for(i=s=0,u=e-1;0<=u?s<=u:s>=u;i=0<=u?++s:--s)for(r=o=0,a=e-1;0<=a?o<=a:o>=a;r=0<=a?++o:--o)if(f.grid[t+i][n+r])return!1;return!0};for(i=s=0,u=this.y_count-e;0<=u?s<=u:s>=u;i=0<=u?++s:--s)for(t=o=0,a=this.x_count-e;0<=a?o<=a:o>=a;t=0<=a?++o:--o)n(i,t)&&r.push({row:i,column:t});return r};return r}();